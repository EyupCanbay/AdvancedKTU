# ğŸ—ï¸ Sistem Mimarisi DetaylÄ± DokÃ¼mantasyonu

## Ä°Ã§indekiler

1. [Genel Mimari](#genel-mimari)
2. [Servis Mimarileri](#servis-mimarileri)
3. [Veri AkÄ±ÅŸlarÄ±](#veri-akÄ±ÅŸlarÄ±)
4. [GÃ¼venlik Mimarisi](#gÃ¼venlik-mimarisi)
5. [VeritabanÄ± TasarÄ±mÄ±](#veritabanÄ±-tasarÄ±mÄ±)
6. [Performans ve Scalability](#performans-ve-scalability)

---

## Genel Mimari

### Sistem Topografisi

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT LAYER                             â”‚
â”‚                  (React + TypeScript)                        â”‚
â”‚                                                              â”‚
â”‚  Pages:                                                      â”‚
â”‚  â€¢ Home (Landing)        â€¢ LoginPage (Auth)                â”‚
â”‚  â€¢ RegisterPage          â€¢ CentersPage (Map)               â”‚
â”‚  â€¢ ImpactDashboard       â€¢ MilestonePage                   â”‚
â”‚                                                              â”‚
â”‚  Components:                                                â”‚
â”‚  â€¢ FeatureCard           â€¢ ImpactDashboard                 â”‚
â”‚  â€¢ MapSideBar            â€¢ WasteSubmissionModal            â”‚
â”‚  â€¢ NearestCenterCard     â€¢ StatusCard                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Auth   â”‚       â”‚ Waste  â”‚      â”‚   AI   â”‚
    â”‚Service â”‚       â”‚Service â”‚      â”‚Service â”‚
    â”‚:8080   â”‚       â”‚:8081   â”‚      â”‚:5000   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚    MongoDB      â”‚
                â”‚   (Shared)      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Deployment Topology

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DOCKER COMPOSE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Services (containers):                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  mongo      â”‚  â”‚  auth-svc   â”‚  â”‚  waste-svc     â”‚  â”‚
â”‚  â”‚  (MongoDB)  â”‚  â”‚  (Go+Echo)  â”‚  â”‚  (Go+Echo)     â”‚  â”‚
â”‚  â”‚  Port:27017 â”‚  â”‚  Port:8080  â”‚  â”‚  Port:8081     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   ai-service   â”‚  â”‚   frontend       â”‚              â”‚
â”‚  â”‚ (Node+Express) â”‚  â”‚ (React+Vite)     â”‚              â”‚
â”‚  â”‚   Port:5000    â”‚  â”‚ Port:5173        â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                          â”‚
â”‚  Networks:                                              â”‚
â”‚  â€¢ ktu_network (internal communication)                 â”‚
â”‚                                                          â”‚
â”‚  Volumes:                                               â”‚
â”‚  â€¢ mongo_data (database persistence)                    â”‚
â”‚  â€¢ ./uploads (image storage)                            â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Servis Mimarileri

### 1. Authentication Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           AUTHENTICATION SERVICE (Port: 8080)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  HTTP HANDLERS LAYER                                    â”‚
â”‚  â”œâ”€â”€ AuthHandler                                        â”‚
â”‚  â”‚   â”œâ”€â”€ Login()        - POST /auth/login             â”‚
â”‚  â”‚   â””â”€â”€ Register()     - POST /auth/register          â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€â”€ UserHandler                                        â”‚
â”‚      â”œâ”€â”€ GetAll()       - GET  /users                  â”‚
â”‚      â”œâ”€â”€ GetByID()      - GET  /users/{id}            â”‚
â”‚      â”œâ”€â”€ Create()       - POST /users                  â”‚
â”‚      â”œâ”€â”€ Update()       - PUT  /users/{id}            â”‚
â”‚      â”œâ”€â”€ Delete()       - DEL  /users/{id}            â”‚
â”‚      â”œâ”€â”€ UpdateRole()   - PUT  /admin/users/{id}/rolesâ”‚
â”‚      â”œâ”€â”€ GetUserRoles() - GET  /admin/users/{id}/rolesâ”‚
â”‚      â””â”€â”€ ListAllUsers() - GET  /admin/users           â”‚
â”‚                                                     â”‚
â”‚  MIDDLEWARE LAYER                                   â”‚
â”‚  â”œâ”€â”€ JWTMiddleware      - Token validation         â”‚
â”‚  â”œâ”€â”€ RequireAdmin()      - Role-based access       â”‚
â”‚  â””â”€â”€ ErrorHandler       - Error management         â”‚
â”‚                                                     â”‚
â”‚  SERVICE LAYER                                      â”‚
â”‚  â”œâ”€â”€ AuthService                                    â”‚
â”‚  â”‚   â”œâ”€â”€ Login()        - Credential validation    â”‚
â”‚  â”‚   â””â”€â”€ Register()     - User creation            â”‚
â”‚  â”‚                                                 â”‚
â”‚  â””â”€â”€ UserService                                    â”‚
â”‚      â”œâ”€â”€ Get()          - Fetch user               â”‚
â”‚      â”œâ”€â”€ GetAll()       - List users               â”‚
â”‚      â”œâ”€â”€ Create()       - Create user              â”‚
â”‚      â”œâ”€â”€ Update()       - Update user              â”‚
â”‚      â”œâ”€â”€ Delete()       - Soft delete user         â”‚
â”‚      â””â”€â”€ UpdateRole()   - Manage roles             â”‚
â”‚                                                     â”‚
â”‚  REPOSITORY LAYER                                   â”‚
â”‚  â””â”€â”€ MongoRepository                                â”‚
â”‚      â”œâ”€â”€ GetByEmail()                               â”‚
â”‚      â”œâ”€â”€ GetByID()                                  â”‚
â”‚      â”œâ”€â”€ GetAll()                                   â”‚
â”‚      â”œâ”€â”€ Create()                                   â”‚
â”‚      â”œâ”€â”€ Update()                                   â”‚
â”‚      â””â”€â”€ Delete()                                   â”‚
â”‚                                                     â”‚
â”‚  DOMAIN LAYER                                       â”‚
â”‚  â”œâ”€â”€ User Model                                     â”‚
â”‚  â”œâ”€â”€ Address Model                                  â”‚
â”‚  â”œâ”€â”€ Role Constants                                 â”‚
â”‚  â”œâ”€â”€ Repository Interface                          â”‚
â”‚  â”œâ”€â”€ Service Interface                              â”‚
â”‚  â””â”€â”€ Helper Functions                               â”‚
â”‚                                                     â”‚
â”‚  DATABASE                                           â”‚
â”‚  â””â”€â”€ MongoDB (users collection)                     â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Kimlik DoÄŸrulama AkÄ±ÅŸÄ±

```
LOGIN REQUEST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Client POST /auth/login
   {
     "email": "user@example.com",
     "password": "password123"
   }
        â”‚
2. AuthHandler.Login() receives request
        â”‚
3. AuthService.Login() is called:
   â”œâ”€â”€ Query: GetByEmail(email)
   â”œâ”€â”€ If not found: Return error
   â”œâ”€â”€ If found:
   â”‚   â””â”€â”€ Compare: bcrypt.CompareHashAndPassword()
   â”‚       â”œâ”€â”€ If mismatch: Return error
   â”‚       â”œâ”€â”€ If match: Generate JWT token
   â”‚       â”‚   Payload:
   â”‚       â”‚   {
   â”‚       â”‚     "sub": user_id,
   â”‚       â”‚     "email": email,
   â”‚       â”‚     "roles": ["user", "admin"],
   â”‚       â”‚     "exp": now + 24h
   â”‚       â”‚   }
   â”‚       â””â”€â”€ Return (token, user, nil)
        â”‚
4. AuthHandler returns response:
   {
     "message": "login successful",
     "token": "eyJhbGc...",
     "user": {...}
   }
        â”‚
5. Frontend stores token in localStorage
```

#### JWT Token Mimarisi

```
JWT = Header.Payload.Signature

HEADER:
{
  "alg": "HS256",
  "typ": "JWT"
}

PAYLOAD:
{
  "sub": "507f1f77bcf86cd799439011",  // User ID
  "email": "user@example.com",
  "roles": ["user", "admin"],
  "iat": 1735000000,                  // Issued at
  "exp": 1735086400                   // Expiration (24h)
}

SIGNATURE:
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret_key
)
```

#### Protected Route Mekanizmi

```
REQUEST TO PROTECTED ENDPOINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

GET /api/impact-analysis
Authorization: Bearer eyJhbGc...
        â”‚
1. JWTMiddleware intercepts request
        â”‚
2. Extract token from "Authorization" header
   â”œâ”€â”€ Check format: "Bearer <token>"
   â”œâ”€â”€ Extract token string
        â”‚
3. Parse and validate token:
   â”œâ”€â”€ Decode header, payload, signature
   â”œâ”€â”€ Verify signature using secret key
   â”œâ”€â”€ Check expiration time (exp > now?)
   â”œâ”€â”€ If invalid or expired: Return 401 Unauthorized
        â”‚
4. Extract claims from token:
   â”œâ”€â”€ user.sub â†’ user_id
   â”œâ”€â”€ user.roles â†’ ["user", "admin"]
   â”œâ”€â”€ Store in context: c.Set("user", token)
        â”‚
5. RBAC Middleware (if required):
   â”œâ”€â”€ GetUserRoles(context)
   â”œâ”€â”€ Check if roles include required role
   â”œâ”€â”€ If not: Return 403 Forbidden
        â”‚
6. Handler executes:
   â”œâ”€â”€ Fetch user from context if needed
   â”œâ”€â”€ Process request
   â”œâ”€â”€ Return response
```

### 2. Waste Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             WASTE SERVICE (Port: 8081)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  HTTP HANDLERS LAYER                                    â”‚
â”‚  â””â”€â”€ WasteHandler                                       â”‚
â”‚      â”œâ”€â”€ UploadAndAnalyze()    - POST /api/upload     â”‚
â”‚      â”œâ”€â”€ GetImpactAnalysis()   - GET  /api/impact-...â”‚
â”‚      â”œâ”€â”€ GetCollectionPoints() - GET  /api/points   â”‚
â”‚      â””â”€â”€ CreateCollectionRequest() - POST /api/req  â”‚
â”‚                                                     â”‚
â”‚  MIDDLEWARE LAYER                                   â”‚
â”‚  â”œâ”€â”€ JWTMiddleware      - Token validation         â”‚
â”‚  â”œâ”€â”€ cors               - Cross-origin requests    â”‚
â”‚  â””â”€â”€ Logger/Recover     - Request logging          â”‚
â”‚                                                     â”‚
â”‚  SERVICE LAYER                                      â”‚
â”‚  â””â”€â”€ WasteService                                   â”‚
â”‚      â”œâ”€â”€ UploadAndAnalyze()    - Main workflow    â”‚
â”‚      â”œâ”€â”€ callAIService()       - AI integration   â”‚
â”‚      â”œâ”€â”€ GetCollectionPoints() - Fetch points     â”‚
â”‚      â”œâ”€â”€ CreateCollectionRequest() - Create req   â”‚
â”‚      â””â”€â”€ [Point Management]                        â”‚
â”‚          â”œâ”€â”€ CreatePoint()                         â”‚
â”‚          â”œâ”€â”€ UpdatePoint()                         â”‚
â”‚          â””â”€â”€ DeletePoint()                         â”‚
â”‚                                                     â”‚
â”‚  REPOSITORY LAYER                                   â”‚
â”‚  â””â”€â”€ MongoRepository                                â”‚
â”‚      â”œâ”€â”€ Create() - Save waste doc                â”‚
â”‚      â”œâ”€â”€ UpdateAnalysis() - Update with AI resultsâ”‚
â”‚      â”œâ”€â”€ GetAllPoints() - Fetch collection points â”‚
â”‚      â”œâ”€â”€ CreateRequest() - Save request           â”‚
â”‚      â”œâ”€â”€ CreatePoint() - Create collection point  â”‚
â”‚      â”œâ”€â”€ UpdatePoint() - Update point             â”‚
â”‚      â”œâ”€â”€ DeletePoint() - Delete point             â”‚
â”‚      â””â”€â”€ SeedPoints/Wastes() - Demo data          â”‚
â”‚                                                     â”‚
â”‚  DOMAIN LAYER                                       â”‚
â”‚  â”œâ”€â”€ Waste Model                                    â”‚
â”‚  â”œâ”€â”€ AIAnalysisResult Model                        â”‚
â”‚  â”œâ”€â”€ CollectionPoint Model                         â”‚
â”‚  â”œâ”€â”€ CollectionRequest Model                       â”‚
â”‚  â”œâ”€â”€ ImpactAnalysis Model                          â”‚
â”‚  â”œâ”€â”€ Repository Interface                          â”‚
â”‚  â””â”€â”€ Service Interface                              â”‚
â”‚                                                     â”‚
â”‚  DATABASE COLLECTIONS                              â”‚
â”‚  â”œâ”€â”€ wastes                                         â”‚
â”‚  â”œâ”€â”€ collection_points                              â”‚
â”‚  â”œâ”€â”€ collection_requests                            â”‚
â”‚  â””â”€â”€ [impact_analysis - calculated]                â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### AtÄ±k Analiz AkÄ±ÅŸÄ±

```
UPLOAD & ANALYZE WORKFLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. POST /api/upload                 â”‚
â”‚    â€¢ file: multipart/form-data      â”‚
â”‚    â€¢ description: string             â”‚
â”‚    â€¢ user_id: from JWT               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Handler validates input          â”‚
â”‚    â€¢ Check auth                      â”‚
â”‚    â€¢ Validate file format            â”‚
â”‚    â€¢ Check file size                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Service layer processing         â”‚
â”‚    â€¢ Create /uploads directory      â”‚
â”‚    â€¢ Generate unique filename       â”‚
â”‚    â€¢ Save file to disk              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Create waste document            â”‚
â”‚    {                                â”‚
â”‚      status: "analyzing",           â”‚
â”‚      image_path: "/uploads/...",    â”‚
â”‚      user_id: "...",                â”‚
â”‚      description: "..."             â”‚
â”‚    }                                â”‚
â”‚    Insert to MongoDB                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Call AI Service (Async)                 â”‚
â”‚    POST http://ai-service:5000/risk-degree â”‚
â”‚    {                                        â”‚
â”‚      "image_path": "...",                   â”‚
â”‚      "description": "..."                   â”‚
â”‚    }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚ AI Service  â”‚ (See below)
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Parse AI Response                â”‚
â”‚    {                                â”‚
â”‚      "success": true,               â”‚
â”‚      "data": {                      â”‚
â”‚        "fullyChargingPhones": 45,  â”‚
â”‚        "CO2Emission": 15.5,         â”‚
â”‚        "riskDegree": 8,             â”‚
â”‚        ...                          â”‚
â”‚      }                              â”‚
â”‚    }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Update waste document            â”‚
â”‚    UpdateAnalysis():                â”‚
â”‚    â€¢ ai_analysis: {...}             â”‚
â”‚    â€¢ status: "analyzed"             â”‚
â”‚    â€¢ updated_at: now                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Calculate impact metrics         â”‚
â”‚    â€¢ Add to total CO2 saved         â”‚
â”‚    â€¢ Add to total water saved       â”‚
â”‚    â€¢ Update waste count             â”‚
â”‚    â€¢ Check risk levels              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. Return response                  â”‚
â”‚    {                                â”‚
â”‚      "success": true,               â”‚
â”‚      "waste": {...},                â”‚
â”‚      "impact": {                    â”‚
â”‚        "CO2Saved": 15.5,            â”‚
â”‚        "status": "analyzed"         â”‚
â”‚      }                              â”‚
â”‚    }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. AI Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AI SERVICE (Port: 5000)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  HTTP ROUTES LAYER                                      â”‚
â”‚  â”œâ”€â”€ GET /              - Health check               â”‚
â”‚  â””â”€â”€ POST /risk-degree  - Analyze waste              â”‚
â”‚                                                     â”‚
â”‚  MIDDLEWARE LAYER                                   â”‚
â”‚  â”œâ”€â”€ express.json()     - Parse JSON                â”‚
â”‚  â””â”€â”€ errorHandler       - Error handling            â”‚
â”‚                                                     â”‚
â”‚  SERVICE LAYER                                      â”‚
â”‚  â””â”€â”€ GeminiService                                  â”‚
â”‚      â”œâ”€â”€ initializeModel() - Init Google Gemini    â”‚
â”‚      â”œâ”€â”€ getRiskAssessmentPrompt() - Create prompt â”‚
â”‚      â””â”€â”€ analyzeImage()    - Send to Gemini API    â”‚
â”‚                                                     â”‚
â”‚  UTILITY LAYER                                      â”‚
â”‚  â””â”€â”€ ImageService                                   â”‚
â”‚      â”œâ”€â”€ getImageData()    - Read image file       â”‚
â”‚      â””â”€â”€ validateImage()   - Validate format       â”‚
â”‚                                                     â”‚
â”‚  EXTERNAL APIS                                      â”‚
â”‚  â”œâ”€â”€ Google Cloud Vision API - Image processing    â”‚
â”‚  â””â”€â”€ Google Gemini API 2.5   - AI Analysis         â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### AI Analiz AkÄ±ÅŸÄ±

```
RISK DEGREE ANALYSIS FLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. POST /risk-degree                   â”‚
â”‚    {                                   â”‚
â”‚      "image_path": "C:/uploads/...",   â”‚
â”‚      "description": "Electronic waste" â”‚
â”‚    }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ImageService.getImageData()               â”‚
â”‚    â€¢ Read image file from disk               â”‚
â”‚    â€¢ Convert to base64 or bytes              â”‚
â”‚    â€¢ Extract image metadata                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Google Cloud Vision API (Optional)        â”‚
â”‚    â€¢ Image classification                    â”‚
â”‚    â€¢ Object detection                        â”‚
â”‚    â€¢ Text extraction (if any)                â”‚
â”‚    â€¢ Quality assessment                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Generate Risk Assessment Prompt              â”‚
â”‚                                                  â”‚
â”‚ "You are a senior environmental impact expert.  â”‚
â”‚  Analyze this waste image and calculate:        â”‚
â”‚                                                  â”‚
â”‚  - fullyChargingPhones (battery capacity)        â”‚
â”‚  - CO2Emission (carbon footprint)                â”‚
â”‚  - riskDegree (1-10 scale)                       â”‚
â”‚  - cost (economic impact)                        â”‚
â”‚  - ... (14 more metrics)                        â”‚
â”‚                                                  â”‚
â”‚  Return ONLY valid JSON with these exact keys." â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Call Google Gemini API 2.5                      â”‚
â”‚    â€¢ Send image + prompt                           â”‚
â”‚    â€¢ Model: gemini-2.5-flash                       â”‚
â”‚    â€¢ Response type: application/json               â”‚
â”‚    â€¢ Temperature: default (0.7)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Gemini Analyzes and Returns JSON                â”‚
â”‚    {                                               â”‚
â”‚      "fullyChargingPhones": 45,                    â”‚
â”‚      "lightHours": 120.5,                          â”‚
â”‚      "CO2Emission": 15.5,                          â”‚
â”‚      "cleanWater": 5000.0,                         â”‚
â”‚      "riskDegree": 8,                              â”‚
â”‚      "cost": 245.50,                               â”‚
â”‚      ... (11 more fields)                          â”‚
â”‚    }                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Parse and Validate Response                     â”‚
â”‚    â€¢ Check all required fields exist               â”‚
â”‚    â€¢ Validate numeric ranges                       â”‚
â”‚    â€¢ Check data types                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Return Success Response                         â”‚
â”‚    {                                               â”‚
â”‚      "success": true,                              â”‚
â”‚      "data": {                                     â”‚
â”‚        "fullyChargingPhones": 45,                  â”‚
â”‚        "CO2Emission": 15.5,                        â”‚
â”‚        "riskDegree": 8,                            â”‚
â”‚        ...                                         â”‚
â”‚      }                                             â”‚
â”‚    }                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Veri AkÄ±ÅŸlarÄ±

### End-to-End User Journey

```
USER REGISTRATION â†’ LOGIN â†’ WASTE SUBMISSION â†’ IMPACT VIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STEP 1: REGISTRATION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: RegisterPage.tsx                          â”‚
â”‚ â€¢ User enters: email, password, name, address       â”‚
â”‚                                                     â”‚
â”‚ POST /auth/register                                â”‚
â”‚ {                                                  â”‚
â”‚   "email": "user@example.com",                     â”‚
â”‚   "password": "hashed_by_frontend",                â”‚
â”‚   "first_name": "John",                            â”‚
â”‚   "last_name": "Doe",                              â”‚
â”‚   "addresses": [...]                               â”‚
â”‚ }                                                  â”‚
â”‚                                                     â”‚
â”‚ AuthService â†’ Validate â†’ Hash Password â†’           â”‚
â”‚ â†’ Save to MongoDB                                  â”‚
â”‚                                                     â”‚
â”‚ Response: 201 Created                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 2: LOGIN
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: LoginPage.tsx                             â”‚
â”‚ â€¢ User enters: email, password                      â”‚
â”‚                                                     â”‚
â”‚ POST /auth/login                                   â”‚
â”‚ {                                                  â”‚
â”‚   "email": "user@example.com",                     â”‚
â”‚   "password": "password"                           â”‚
â”‚ }                                                  â”‚
â”‚                                                     â”‚
â”‚ AuthService â†’ Query by email â†’                     â”‚
â”‚ â†’ Compare bcrypt â†’ Generate JWT                    â”‚
â”‚                                                     â”‚
â”‚ Response: 200                                       â”‚
â”‚ {                                                  â”‚
â”‚   "token": "eyJhbGc...",                          â”‚
â”‚   "user": {...}                                    â”‚
â”‚ }                                                  â”‚
â”‚                                                     â”‚
â”‚ Frontend: Store token in localStorage              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 3: WASTE SUBMISSION
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: WasteSubmissionModal.tsx                  â”‚
â”‚ â€¢ User selects image                                â”‚
â”‚ â€¢ Adds description                                  â”‚
â”‚                                                     â”‚
â”‚ POST /api/upload                                   â”‚
â”‚ multipart/form-data                                â”‚
â”‚ â€¢ file                                             â”‚
â”‚ â€¢ description                                      â”‚
â”‚ â€¢ Authorization: Bearer {token}                    â”‚
â”‚                                                     â”‚
â”‚ Waste Service:                                      â”‚
â”‚ 1. Save file to /uploads                          â”‚
â”‚ 2. Create waste document (status: analyzing)       â”‚
â”‚ 3. Call AI Service                                 â”‚
â”‚    POST ai-service:5000/risk-degree                â”‚
â”‚ 4. Gemini API analyzes                             â”‚
â”‚ 5. Update waste document (status: analyzed)        â”‚
â”‚ 6. Calculate impact metrics                        â”‚
â”‚                                                     â”‚
â”‚ Response: 201                                       â”‚
â”‚ {                                                  â”‚
â”‚   "waste": {...},                                  â”‚
â”‚   "ai_analysis": {...},                            â”‚
â”‚   "impact_added": {...}                            â”‚
â”‚ }                                                  â”‚
â”‚                                                     â”‚
â”‚ Frontend: Show success message                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 4: VIEW IMPACT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend: ImpactDashboard.tsx                       â”‚
â”‚                                                     â”‚
â”‚ GET /api/impact-analysis                           â”‚
â”‚ Authorization: Bearer {token}                      â”‚
â”‚                                                     â”‚
â”‚ Response: 200                                       â”‚
â”‚ {                                                  â”‚
â”‚   "totalCO2Saved": 245.5,                          â”‚
â”‚   "totalWaterSaved": 5000.0,                       â”‚
â”‚   "treesEquivalent": 9.8,                          â”‚
â”‚   "totalWasteProcessed": 87,                       â”‚
â”‚   ...                                              â”‚
â”‚ }                                                  â”‚
â”‚                                                     â”‚
â”‚ Frontend: Render metrics with visuals              â”‚
â”‚ â€¢ Progress bars                                    â”‚
â”‚ â€¢ Statistics cards                                  â”‚
â”‚ â€¢ Charts                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## GÃ¼venlik Mimarisi

### Authentication & Authorization

```
SECURITY LAYERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Transport Security         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… HTTPS (in production)            â”‚
â”‚ âœ… TLS 1.3+                         â”‚
â”‚ âœ… CORS validation                  â”‚
â”‚ âœ… Rate limiting                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Input Validation           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Email format validation          â”‚
â”‚ âœ… Password strength check          â”‚
â”‚ âœ… File type validation             â”‚
â”‚ âœ… File size limits                 â”‚
â”‚ âœ… Injection prevention             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Authentication             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… bcrypt password hashing          â”‚
â”‚ âœ… JWT token generation             â”‚
â”‚ âœ… Token expiration (24h)           â”‚
â”‚ âœ… Token signature verification     â”‚
â”‚ âœ… Refresh token (future)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: Authorization              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… JWT middleware                   â”‚
â”‚ âœ… Role-based access control        â”‚
â”‚ âœ… User ID validation               â”‚
â”‚ âœ… Admin-only endpoints              â”‚
â”‚ âœ… Soft delete filtering             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 5: Data Protection            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Password field excluded from JSONâ”‚
â”‚ âœ… Soft delete (no hard delete)     â”‚
â”‚ âœ… Audit trail via timestamps       â”‚
â”‚ âœ… File storage isolation            â”‚
â”‚ âœ… Database query filtering          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### RBAC (Role-Based Access Control)

```
ROLE HIERARCHY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    Admin     â”‚
                    â”‚   (user)     â”‚
                    â”‚   (admin)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                         â”‚
              â–¼                         â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User         â”‚          â”‚ Can Access   â”‚
        â”‚ (user)       â”‚          â”‚              â”‚
        â”‚              â”‚          â”‚ ALL + MORE:  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚              â”‚
                                  â”‚ GET /admin/* â”‚
PERMISSIONS:                      â”‚ PUT /admin/* â”‚
                                  â”‚ DEL /admin/* â”‚
User (user role):                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â€¢ Read own profile
â€¢ Update own profile
â€¢ Upload waste
â€¢ View collection points
â€¢ View own waste submissions
â€¢ View impact analysis

Admin (user + admin role):
â€¢ All user permissions +
â€¢ Create users
â€¢ Read all users
â€¢ Update all users
â€¢ Delete (soft) all users
â€¢ Manage user roles
â€¢ View admin dashboard
â€¢ Manage collection points
```

---

## VeritabanÄ± TasarÄ±mÄ±

### Collection Relationships

```
ENTITY RELATIONSHIP DIAGRAM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       USERS             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id (PK)                â”‚
â”‚ email (unique)          â”‚
â”‚ password                â”‚
â”‚ first_name              â”‚
â”‚ last_name               â”‚
â”‚ roles                   â”‚
â”‚ addresses (embedded)    â”‚
â”‚ active                  â”‚
â”‚ deleted_at (soft del)   â”‚
â”‚ created_at              â”‚
â”‚ updated_at              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ (1)
           â”‚
           â”‚ (*)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       WASTES            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id (PK)                â”‚
â”‚ user_id (FK)            â”‚â—„â”€â”€â”€â”€â”€â”
â”‚ image_path              â”‚      â”‚
â”‚ description             â”‚      â”‚
â”‚ status                  â”‚      â”‚
â”‚ ai_analysis (embedded)  â”‚      â”‚
â”‚ created_at              â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
           â”‚ (1)                 â”‚
           â”‚                     â”‚
           â”‚ (*)                 â”‚
           â–¼                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   COLLECTION_REQUESTS        â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ _id (PK)                     â”‚ â”‚
â”‚ user_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ waste_id (FK)                â”‚
â”‚ collection_point_id (FK)     â”‚
â”‚ status                       â”‚
â”‚ created_at                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ (*)
               â”‚
               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚             â”‚
               â–¼             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ WASTES      â”‚ â”‚ COLL_POINTS â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Indexing Strategy

```
COLLECTION INDEXES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

users collection:
  â€¢ _id (default)
  â€¢ email (unique) - for fast login lookup
  â€¢ deleted_at - for soft delete filtering
  â€¢ created_at (descending) - for sorting

wastes collection:
  â€¢ _id (default)
  â€¢ user_id - for user's waste filtering
  â€¢ status - for quick status queries
  â€¢ created_at (descending) - for sorting

collection_points collection:
  â€¢ _id (default)
  â€¢ [location index] - for geo-queries (future)

collection_requests collection:
  â€¢ _id (default)
  â€¢ user_id - for user's requests
  â€¢ status - for filtering
```

---

## Performans ve Scalability

### Performance Considerations

```
OPTIMIZATION STRATEGIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. CACHING
   â”œâ”€â”€ Frontend:
   â”‚   â€¢ localStorage for JWT tokens
   â”‚   â€¢ React Context for user state
   â”‚   â€¢ Component-level memoization
   â”‚
   â””â”€â”€ Backend:
       â€¢ MongoDB indexing
       â€¢ [Future] Redis caching layer

2. DATABASE OPTIMIZATION
   â”œâ”€â”€ Query Optimization:
   â”‚   â€¢ Compound indexes on frequently queried fields
   â”‚   â€¢ Projection to fetch only needed fields
   â”‚   â€¢ Pagination for large result sets
   â”‚
   â”œâ”€â”€ Connection Pooling:
   â”‚   â€¢ MongoDB connection pool (default 100)
   â”‚
   â””â”€â”€ Soft Delete Filtering:
       â€¢ deleted_at: null queries

3. API OPTIMIZATION
   â”œâ”€â”€ Request Compression:
   â”‚   â€¢ gzip compression (Echo middleware)
   â”‚
   â”œâ”€â”€ Response Optimization:
   â”‚   â€¢ JSON minification
   â”‚   â€¢ Field filtering
   â”‚
   â””â”€â”€ Async Processing:
       â€¢ AI analysis happens async
       â€¢ Prevents blocking requests

4. FILE HANDLING
   â”œâ”€â”€ Image Optimization:
   â”‚   â€¢ Size validation
   â”‚   â€¢ Format validation
   â”‚   â€¢ Organized file structure
   â”‚
   â””â”€â”€ Storage Strategy:
       â€¢ Disk storage for images
       â€¢ [Future] Cloud storage (S3, GCS)

5. NETWORK OPTIMIZATION
   â”œâ”€â”€ Inter-service Communication:
   â”‚   â€¢ Direct Docker network (faster than HTTP)
   â”‚   â€¢ Connection pooling
   â”‚
   â””â”€â”€ Frontend Optimization:
       â€¢ Code splitting (Vite)
       â€¢ Lazy loading
       â€¢ Tree shaking
```

### Scalability Architecture

```
HORIZONTAL SCALING PLAN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Current (Single Instance):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Single Server                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Frontend  Auth  Waste  AI        â”‚   â”‚
â”‚ â”‚ Services  Service Service Serviceâ”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                            â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚      â”‚  MongoDB   â”‚                     â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Target (Distributed):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Load Balancer                           â”‚
â”‚              (Nginx/HAProxy)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Frontend #1    â”‚   â”‚  Frontend #2    â”‚
        â”‚  Auth Svc #1    â”‚   â”‚  Auth Svc #2    â”‚
        â”‚  Waste Svc #1   â”‚   â”‚  Waste Svc #2   â”‚
        â”‚  AI Svc #1      â”‚   â”‚  AI Svc #1      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚ MongoDB     â”‚
                    â”‚ Replica Set â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Key Components:
1. Load Balancer: Distributes traffic
2. Multiple Service Instances: Horizontal scaling
3. Shared Database: MongoDB Replica Set
4. Caching Layer: Redis (future)
5. Message Queue: RabbitMQ (for async tasks)
```

---

**Son GÃ¼ncelleme**: 27 AralÄ±k 2025  
**Versiyon**: 1.0.0-architecture
